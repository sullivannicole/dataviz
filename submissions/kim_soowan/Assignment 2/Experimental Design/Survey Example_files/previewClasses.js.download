qrequire.define("classes/PreviewPage",["dejavu","log","bluebird","utils","dom","classes/BrowserPage"],function(t,e,i,n,$,o){"use strict";return t.Class.declare({$name:"PreviewPage",$extends:o,__showHiddenQuestions:!0,__syncing:!1,__scrolling:!1,__autoScrolling:!1,initialize:function(t){o.prototype.initialize.call(this,t),this.once("prerender",function(){this._setPageMaxWidth(),this.showHiddenQuestions(this.getDictatorService().shouldShowHiddenQuestions()),this.setDocumentEventHandler("mouseup",function(){this.getDictatorService().bubbleMouseup()}.$bind(this))}),this.once("ready",function(){this.getDictatorService().addPage(this),this._watchScrolling()}),this.on("postrender",function(){n.each(this.getCurrentPageQuestionRenderers(),function(t){var e=t.getElement();e.find("a").each(function(){$(this).attr("target")||$(this).attr("target","_parent")})})}),this.on("transitioning",this._startTransition),this.on("ready",this._endTransition)},_setPageMaxWidth:function(){$("body").css("max-width","100vw")},_startTransition:function(){this.getDictatorService().startTransition()},_endTransition:function(){this.getDictatorService().endTransition()},_notifyOutdatedSession:function(){e.info("Replacing outdated page template")},_watchScrolling:function(){$(window).scroll(function(){this.__scrolling||this._pageScrolled(),this.__scrolling=!1}.$bind(this))},_scrollToTop:function(){this.getDictatorService().scrollToTop()||o.prototype._scrollToTop.call(this)},_getQuestionPositions:function(){var t=[];return n.each(this.getCurrentPageQuestionRenderers(),function(e){t.push({qid:e.id(),top:e.getTop()})}),t},render:function(){return this.getDictatorService().shouldRender()?o.prototype.render.apply(this,arguments):i.resolve()},_getTop:function(){var t=$(window).scrollTop();return t},_getTransitioningQuestion:function(){var t=this._getQuestionPositions();t.sort(function(t,e){return t.top-e.top});for(var e,i=0;i<t.length&&this._getTop()>=t[i].top;i++)e=t[i].qid;return e},_getScrollProgress:function(t){var e=this._questionRenderers[t];return e?(this._getTop()-e.getTop())/e.getHeight():0},_pageScrolled:function(){var t=this._getTransitioningQuestion();t?this.autoScroll(t,this._getScrollProgress(t)):this.autoScrollHeader(this._getTop()/this.getHeaderBottom())},scrollToQuestion:function(t,e){this.__autoScrolling||(this.__scrolling=!0,o.prototype.scrollToQuestion.call(this,t,e))},scrollToHeader:function(t){this.__autoScrolling||(this.__scrolling=!0,o.prototype.scrollToHeader.call(this,t))},autoScroll:function(t,e){this.__autoScrolling=!0,this.getDictatorService().autoScroll(t,e),this.__autoScrolling=!1},autoScrollHeader:function(t){this.__autoScrolling=!0,this.getDictatorService().autoScrollHeader(t),this.__autoScrolling=!1},getDictatorService:function(){var t=this.syncPageTemplate.$bind(this);return window.parent.DictatorService||{addPage:function(){},bubbleMouseup:function(){},shouldIgnoreValidation:function(){},shouldShowHiddenQuestions:function(){},isEndOfSurvey:function(){},disableBanner:function(){},syncPageTemplate:function(e,i,n){return t(i,n)},shouldRender:function(){return!1},scrollToTop:function(){return!1},autoScroll:function(){},autoScrollHeader:function(){},triggerEventOnPages:function(){},removeBookmark:function(){},startTransition:function(){},endTransition:function(){}}},_renderPageTemplate:function(t,e){return this.__syncing?o.prototype._renderPageTemplate.call(this,t,e):this.getDictatorService().syncPageTemplate(this,t,e)},syncPageTemplate:function(t,e){this.__syncing=!0;var i=this._renderPageTemplate(t,e);return this.__syncing=!1,i},renderEOS:function(t){return this.getDictatorService().isEndOfSurvey(!t.confirmResponse()),o.prototype.renderEOS.call(this,t)},_prevalidate:function(t){return this.getDictatorService().shouldIgnoreValidation()?i.resolve(!0):o.prototype._prevalidate.call(this,t)},_saveProgress:function(){},isPreview:function(){return!0},triggerEvent:function(t){this._trigger(t)},serializePageRuntime:function(t){t||this.getDictatorService().triggerEventOnPages("beforeSerialize");var e=o.prototype.serializePageRuntime.call(this,t);return e.setPreviewOptions({IgnoreValidation:this.getDictatorService().shouldIgnoreValidation()}),e},restart:function(){window.location.href=window.location.href.replace(/Q_CloneSession=(FS_[0-9,A-z]+)/,"")},setBookmark:function(){this.adapter.setBookmark(this.serializePageRuntime(!0))},removeBookmark:function(){this.adapter.removeBookmark()},startFromBookmark:function(){this._transactionId=null,this.adapter.startFromBookmark(this.serializePageRuntime()).then(function(t){this._renderPageTemplate(t)}.$bind(this))["catch"](function(t){if("BookmarkNotFound"==t.errorCode)return this.getDictatorService().removeBookmark();throw t}.$bind(this))},savePreviewAnswers:function(){return this.adapter.saveSelections(this.runtime.FormSessionID)},clearPreviewAnswers:function(){return this.adapter.clearSelections()},showHiddenQuestions:function(t){t!=this.__showHiddenQuestions&&(this.__showHiddenQuestions=t,n.each(this.getCurrentPageQuestionRenderers(),function(e){e.showHiddenQuestion(t)}.$bind(this)))},shouldShowHiddenQuestions:function(){return this.__showHiddenQuestions},redirectToUrl:function(t){this.getDictatorService().disableBanner(),window.top.location.replace(t)},checkForSessionChanges:function(){},setDocumentEventHandler:function(t,e){$(document).on(t,e)}},!0)}),qrequire.define("adapters/PreviewAdapter",["dejavu","bluebird","dom","classes/page/PageTemplate","adapters/SpokeAdapter"],function(t,e,$,i,n){"use strict";return t.Class.declare({$name:"PreviewAdapter",$extends:n,initialize:function(){this.$super()},restart:function(t){return this.__performPreviewAction("restart",{FormSessionID:t.getFormSessionID()})},__performPreviewAction:function(t,n){return e.resolve($.ajax({type:"POST",url:this._formID+"/previewAction/"+t,contentType:"application/json",data:JSON.stringify(n),dataType:"json"})).then(function(t){return t?(t.FormOptions&&(this._formOptions=t.FormOptions,delete t.FormOptions),new i(t)):t}.$bind(this))["catch"](function(t){throw t.responseJSON&&(t=t.responseJSON),t})},saveSelections:function(t){return this.__performPreviewAction("saveSelections",{FormSessionID:t})},clearSelections:function(){return this.__performPreviewAction("clearSelections")},setBookmark:function(t){this.__performPreviewAction("setBookmark",t.serialize())},removeBookmark:function(){this.__performPreviewAction("removeBookmark",{})},startFromBookmark:function(t){return this.__performPreviewAction("startFromBookmark",t.serialize())["catch"](function(t){throw"BookmarkNotFound"==t.errorCode&&this.handleError(t,"startFromBookmark"),t}.$bind(this))}})}),qrequire.define("bundles/previewClasses",function(){});
//# sourceMappingURL=previewClasses.js.map